@page "/center/{CCEN:int}"
@inject Services.IkastetxeService servicio
@inject IJSRuntime JS
@using ElorMAUI.Components.Model

<h3>Detalles del Centro</h3>
<a href="/centerlist">Volver a la lista</a>

@if (Centro is null)
{
        <p>No se ha encontrado el centro solicitado.</p>
}
else
{
        <div class="card mt-3 mb-3">
            <div class="card-body">
                <h4>@Centro.NOM</h4>
                <p>@Centro.DOMI - @Centro.DMUNIC</p>

                <div id="map" style="height:400px;" class="mb-3"></div>

            @if (mostrarInfo)
            {
                        <div class="alert alert-info">
                            <strong>Teléfono:</strong> @Centro.TEL1<br />
                            <strong>Email:</strong> @Centro.EMAIL
                        </div>
            }
            </div>
        </div>
}

@code {
    [Parameter] public int CCEN { get; set; }

    private Centro? Centro;
    private bool mostrarInfo = false;

    protected override async Task OnParametersSetAsync()
    {
        await servicio.LoadCentrosAsync();

        Centro = servicio.Centros?
            .FirstOrDefault(c => c.CCEN == CCEN);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && Centro?.LATITUD != null && Centro?.LONGITUD != null)
        {
            // ⚠️ Coordenadas intercambiadas en JSON
            await JS.InvokeVoidAsync(
                "createMap",
                Centro.LONGITUD.Value,
                Centro.LATITUD.Value,
                Centro.NOM
            );
        }
    }

    [JSInvokable]
    public void OnMarkerClicked()
    {
        mostrarInfo = true;
        StateHasChanged();
    }
}
